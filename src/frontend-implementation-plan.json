{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "Enable Vibechat as an installable PWA (Add to Home Screen)",
  "requirements": [
    {
      "id": "REQ-45",
      "summary": "Add a Web App Manifest so Vibechat is recognized as an installable PWA with required metadata and icon declarations.",
      "acceptanceCriteria": [
        "A manifest file exists under the frontend static/public assets (e.g., `frontend/public/manifest.webmanifest` or `frontend/public/manifest.json`).",
        "The manifest includes: `name` = \"Vibechat\", `short_name` = \"Vibechat\", `start_url`, `display` (standalone), `background_color`, `theme_color`, and an `icons` array with at least 192x192 and 512x512 PNG icons (including a maskable icon).",
        "The app can be installed on supported browsers (Chrome/Edge/Android) without manifest-related console errors."
      ],
      "file_operations": [
        {
          "path": "frontend/public/manifest.webmanifest",
          "operation": "create",
          "description": "Create the Vibechat web app manifest with required PWA fields (name/short_name, start_url, display=standalone, background_color, theme_color) and icon declarations referencing: frontend/public/assets/generated/vibechat-pwa-icon.dim_192x192.png, frontend/public/assets/generated/vibechat-pwa-icon.dim_512x512.png, and frontend/public/assets/generated/vibechat-pwa-icon-maskable.dim_512x512.png."
        },
        {
          "path": "frontend/public/assets/generated/vibechat-pwa-icon.dim_192x192.png",
          "operation": "create",
          "description": "Add the generated PWA icon asset (192x192) at the exact path frontend/public/assets/generated/vibechat-pwa-icon.dim_192x192.png and ensure the manifest references it."
        },
        {
          "path": "frontend/public/assets/generated/vibechat-pwa-icon.dim_512x512.png",
          "operation": "create",
          "description": "Add the generated PWA icon asset (512x512) at the exact path frontend/public/assets/generated/vibechat-pwa-icon.dim_512x512.png and ensure the manifest references it."
        },
        {
          "path": "frontend/public/assets/generated/vibechat-pwa-icon-maskable.dim_512x512.png",
          "operation": "create",
          "description": "Add the generated maskable PWA icon asset (512x512) at the exact path frontend/public/assets/generated/vibechat-pwa-icon-maskable.dim_512x512.png and ensure the manifest references it with purpose set to include maskable."
        }
      ]
    },
    {
      "id": "REQ-46",
      "summary": "Update frontend/index.html with manifest link, theme-color meta, and icon links including Apple touch icon and favicon.",
      "acceptanceCriteria": [
        "`frontend/index.html` includes a `<link rel=\"manifest\" ...>` pointing to the manifest file.",
        "`frontend/index.html` includes `<meta name=\"theme-color\" ...>` matching the manifest theme color.",
        "`frontend/index.html` references a favicon and an Apple touch icon file that exist in the frontend public assets.",
        "The page still loads normally and the document title remains \"vibechat\" (unless explicitly updated as part of PWA metadata)."
      ],
      "file_operations": [
        {
          "path": "frontend/index.html",
          "operation": "modify",
          "description": "Add required PWA metadata: link rel=\"manifest\" pointing to /manifest.webmanifest, meta name=\"theme-color\" matching the manifest theme_color, link rel=\"icon\" referencing frontend/public/assets/generated/vibechat-favicon.dim_32x32.png, and link rel=\"apple-touch-icon\" referencing frontend/public/assets/generated/vibechat-apple-touch-icon.dim_180x180.png, while keeping the existing title \"vibechat\"."
        },
        {
          "path": "frontend/public/assets/generated/vibechat-apple-touch-icon.dim_180x180.png",
          "operation": "create",
          "description": "Add the generated Apple touch icon asset at the exact path frontend/public/assets/generated/vibechat-apple-touch-icon.dim_180x180.png and ensure index.html references it."
        },
        {
          "path": "frontend/public/assets/generated/vibechat-favicon.dim_32x32.png",
          "operation": "create",
          "description": "Add the generated favicon asset at the exact path frontend/public/assets/generated/vibechat-favicon.dim_32x32.png and ensure index.html references it."
        }
      ]
    },
    {
      "id": "REQ-47",
      "summary": "Add a registerable service worker with safe, lightweight caching for core app shell assets without runtime errors.",
      "acceptanceCriteria": [
        "A service worker file exists in frontend public assets (e.g., `frontend/public/sw.js`) and can be fetched at `/sw.js`.",
        "The service worker installs and activates successfully in supported browsers (no uncaught exceptions).",
        "Core app shell requests needed to load the UI are cached in a safe, minimal way (e.g., cache-first for the shell, network-first for dynamic requests), and the caching logic does not break authenticated usage.",
        "When the service worker is registered, the app still functions normally online."
      ],
      "file_operations": [
        {
          "path": "frontend/public/sw.js",
          "operation": "create",
          "description": "Create a baseline service worker that installs/activates safely and performs lightweight caching for core shell assets (e.g., cache-first for static shell files, network-first or bypass for non-shell/dynamic requests) while avoiding strategies that could break authenticated usage."
        }
      ]
    },
    {
      "id": "REQ-48",
      "summary": "Register the service worker from editable React code (not main.tsx), gated to supported browsers and production-like environments.",
      "acceptanceCriteria": [
        "Service worker registration is triggered from an editable file (e.g., `frontend/src/App.tsx` via a `useEffect`) without changing any immutable paths.",
        "Registration checks for `'serviceWorker' in navigator` and avoids throwing errors on unsupported browsers.",
        "In production builds, the service worker registers and controls the page after reload; in development, the app does not spam console errors if the service worker is absent."
      ],
      "file_operations": [
        {
          "path": "frontend/src/utils/registerServiceWorker.ts",
          "operation": "create",
          "description": "Add a small helper that conditionally registers /sw.js only when the environment is production-like and the browser supports service workers, and degrades quietly in development if /sw.js is missing."
        },
        {
          "path": "frontend/src/App.tsx",
          "operation": "modify",
          "description": "Wire service worker registration into an editable file by calling the registration helper from a useEffect (without modifying frontend/src/main.tsx) and ensuring it checks for 'serviceWorker' in navigator and runs only in production-like builds."
        }
      ]
    },
    {
      "id": "REQ-49",
      "summary": "Provide an unauthenticated UI affordance to install Vibechat as a PWA with clear English guidance and a fallback when install isnâ€™t available.",
      "acceptanceCriteria": [
        "Unauthenticated UI (e.g., `LandingPage` and/or `PreLoginIntroPage`) includes an \"Install Vibechat\" action when the browser fires the install prompt event (or otherwise provides a short message if install is not available).",
        "User-facing text is in English and does not claim installation is always available; it clearly indicates it depends on the browser/device.",
        "If the install prompt is available, clicking the install action triggers the browser install prompt (where supported).",
        "If the install prompt is not available, the UI shows a helpful fallback message such as \"To install, open your browser menu and choose 'Add to Home Screen' (if available).\""
      ],
      "file_operations": [
        {
          "path": "frontend/src/hooks/usePWAInstallPrompt.ts",
          "operation": "create",
          "description": "Create a React hook that listens for the browser install prompt event, exposes whether installation is currently available, and provides a function to trigger the prompt when supported."
        },
        {
          "path": "frontend/src/components/PWAInstallCallout.tsx",
          "operation": "create",
          "description": "Create a small callout component for unauthenticated screens that uses the install prompt hook and renders: (1) an \"Install Vibechat\" action when available, and (2) an English fallback message explaining that availability depends on browser/device and suggesting the browser menu 'Add to Home Screen' option when not available. Use existing shadcn-ui Button component for the action (Verify the component's usage instructions before implementing)."
        },
        {
          "path": "frontend/src/pages/LandingPage.tsx",
          "operation": "modify",
          "description": "Add the PWA install callout to the unauthenticated LandingPage UI so users can install Vibechat when supported (and see the English fallback guidance otherwise)."
        },
        {
          "path": "frontend/src/pages/PreLoginIntroPage.tsx",
          "operation": "modify",
          "description": "Add the PWA install callout to the unauthenticated PreLoginIntroPage UI so users can install Vibechat when supported (and see the English fallback guidance otherwise)."
        }
      ]
    }
  ]
}